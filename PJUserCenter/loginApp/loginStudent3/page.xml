<page>
  <controls count="27">
    <control type="DivRoot" pathname="/divRoot">
      <backgroundColor>F3F3F3</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>819</height>
      <left>0</left>
      <onControlLoad>/*var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
if (!isIOS) {
    ee.getControl("layoutyitem1").heavy = 0;
}*/
setTimeout(function(){
    ee.autoResize = false;
},1000);
</onControlLoad>
      <pageHead><![CDATA[<meta name="viewport" content="width=device-width, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">]]></pageHead>
      <top>0</top>
      <width>1105</width>
    </control>
    <control type="Panel" pathname="/divRoot/panel3">
      <backgroundColor>FFFFFF</backgroundColor>
      <backgroundSkin>body5</backgroundSkin>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>483</height>
      <heightRatio>0.58974358974359</heightRatio>
      <left>41</left>
      <leftRatio>0.0368763557483731</leftRatio>
      <sizeRatio>1.13114754098361</sizeRatio>
      <top>196</top>
      <topRatio>0.239316239316239</topRatio>
      <width>1024</width>
      <widthRatio>0.926247288503254</widthRatio>
    </control>
    <control type="LayoutX" pathname="/divRoot/panel3/layoutx1">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fieldCount>2</fieldCount>
      <height>35</height>
      <heightRatio>0.072463768115942</heightRatio>
      <left>132</left>
      <leftRatio>0.128805620608899</leftRatio>
      <sizeRatio>0.110062893081761</sizeRatio>
      <top>106</top>
      <topRatio>0.219461697722567</topRatio>
      <width>763</width>
      <widthRatio>0.744730679156909</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx1/layoutxitem1">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontSizeAuto>30</fontSizeAuto>
      <hAlign>right</hAlign>
      <heavy>80</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.160550458715596</sizeRatio>
      <text>昵称：</text>
      <top>0</top>
      <width>218</width>
      <widthRatio>0.285714285714286</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx1/layoutxitem2">
      <backgroundColor>d0d0d0</backgroundColor>
      <heavy>200</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>218</left>
      <leftRatio>0.285714285714286</leftRatio>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>0.714285714285714</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/panel3/layoutx1/layoutxitem2/edit1">
      <backgroundSkin>edit1</backgroundSkin>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <inputFontSize>30</inputFontSize>
      <inputFontSizeAuto>30</inputFontSizeAuto>
      <left>0</left>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3/panel5">
      <backgroundSkin>button3</backgroundSkin>
      <cursor>pointer</cursor>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontColor>FFFFFF</fontColor>
      <fontSizeAuto>30</fontSizeAuto>
      <height>39</height>
      <heightRatio>0.0807453416149068</heightRatio>
      <left>532</left>
      <leftRatio>0.519480519480519</leftRatio>
      <onClick>checkName();                                                         </onClick>
      <sizeRatio>0.202072538860104</sizeRatio>
      <text>看看是否重名</text>
      <top>173</top>
      <topRatio>0.358178053830228</topRatio>
      <width>367</width>
      <widthRatio>0.358070500927644</widthRatio>
    </control>
    <control type="LayoutX" pathname="/divRoot/panel3/layoutx2">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fieldCount>2</fieldCount>
      <height>35</height>
      <heightRatio>0.072463768115942</heightRatio>
      <left>129</left>
      <leftRatio>0.126463700234192</leftRatio>
      <sizeRatio>0.110062893081761</sizeRatio>
      <top>270</top>
      <topRatio>0.559006211180124</topRatio>
      <width>763</width>
      <widthRatio>0.744730679156909</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx2/layoutxitem3">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontSizeAuto>30</fontSizeAuto>
      <hAlign>right</hAlign>
      <heavy>80</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.160550458715596</sizeRatio>
      <text>登录密码：</text>
      <top>0</top>
      <width>218</width>
      <widthRatio>0.285714285714286</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx2/layoutxitem4">
      <backgroundColor>d0d0d0</backgroundColor>
      <heavy>200</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>218</left>
      <leftRatio>0.285714285714286</leftRatio>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>0.714285714285714</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/panel3/layoutx2/layoutxitem4/edit2">
      <backgroundSkin>edit1</backgroundSkin>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <inputFontSize>30</inputFontSize>
      <inputFontSizeAuto>30</inputFontSizeAuto>
      <inputPassword>true</inputPassword>
      <left>0</left>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3/panel6">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>40</fontSizeAuto>
      <hAlign>right</hAlign>
      <height>19</height>
      <heightRatio>0.0393374741200828</heightRatio>
      <left>216</left>
      <leftRatio>0.210772833723653</leftRatio>
      <sizeRatio>0.0671378091872792</sizeRatio>
      <text>2-10个汉字或英文长度</text>
      <top>150</top>
      <topRatio>0.31055900621118</topRatio>
      <vAlign>top</vAlign>
      <width>679</width>
      <widthRatio>0.662763466042155</widthRatio>
    </control>
    <control type="LayoutX" pathname="/divRoot/panel3/layoutx3">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fieldCount>2</fieldCount>
      <height>35</height>
      <heightRatio>0.072463768115942</heightRatio>
      <left>129</left>
      <leftRatio>0.126463700234192</leftRatio>
      <sizeRatio>0.110062893081761</sizeRatio>
      <top>315</top>
      <topRatio>0.652173913043478</topRatio>
      <width>763</width>
      <widthRatio>0.744730679156909</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx3/layoutxitem5">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontSizeAuto>30</fontSizeAuto>
      <hAlign>right</hAlign>
      <heavy>80</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.160550458715596</sizeRatio>
      <text>重复密码：</text>
      <top>0</top>
      <width>218</width>
      <widthRatio>0.285714285714286</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/panel3/layoutx3/layoutxitem6">
      <backgroundColor>d0d0d0</backgroundColor>
      <heavy>200</heavy>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <left>218</left>
      <leftRatio>0.285714285714286</leftRatio>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>0.714285714285714</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/panel3/layoutx3/layoutxitem6/edit3">
      <backgroundSkin>edit1</backgroundSkin>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>35</height>
      <heightRatio>1</heightRatio>
      <inputFontSize>30</inputFontSize>
      <inputFontSizeAuto>30</inputFontSizeAuto>
      <inputPassword>true</inputPassword>
      <left>0</left>
      <sizeRatio>0.0642201834862385</sizeRatio>
      <top>0</top>
      <width>545</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3/panel7">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>40</fontSizeAuto>
      <hAlign>right</hAlign>
      <height>31</height>
      <heightRatio>0.0641821946169772</heightRatio>
      <left>62</left>
      <leftRatio>0.0608899297423888</leftRatio>
      <sizeRatio>0.0893371757925072</sizeRatio>
      <text>密码长度为6-15个英文字母，最好同时包含数字和英文字母</text>
      <top>362</top>
      <topRatio>0.749482401656315</topRatio>
      <vAlign>top</vAlign>
      <width>832</width>
      <widthRatio>0.812646370023419</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3/panel48">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontBold>true</fontBold>
      <fontColor>48A1DD</fontColor>
      <fontSizeAuto>30</fontSizeAuto>
      <hAlign>left</hAlign>
      <height>36</height>
      <heightRatio>0.0745341614906832</heightRatio>
      <left>50</left>
      <leftRatio>0.0491803278688525</leftRatio>
      <sizeRatio>0.173913043478261</sizeRatio>
      <text>账户基本信息卡片</text>
      <top>18</top>
      <topRatio>0.0372670807453416</topRatio>
      <width>496</width>
      <widthRatio>0.484777517564403</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3/panel49">
      <backgroundColor>48A1DD</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>2</height>
      <heightRatio>0.0041407867494824</heightRatio>
      <left>48</left>
      <leftRatio>0.0468384074941452</leftRatio>
      <sizeRatio>0.005249343832021</sizeRatio>
      <top>55</top>
      <topRatio>0.113871635610766</topRatio>
      <width>914</width>
      <widthRatio>0.892271662763466</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel1">
      <backgroundSkin>button3</backgroundSkin>
      <cursor>pointer</cursor>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontColor>FFFFFF</fontColor>
      <fontSizeAuto>20</fontSizeAuto>
      <height>46</height>
      <heightRatio>0.0561660561660562</heightRatio>
      <left>237</left>
      <leftRatio>0.214755295836377</leftRatio>
      <onClick>reg();  
</onClick>
      <sizeRatio>0.0619946091644205</sizeRatio>
      <text>确定</text>
      <top>709</top>
      <topRatio>0.865689865689866</topRatio>
      <width>599</width>
      <widthRatio>0.54200146092038</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel4">
      <backgroundColor>FFFFFF</backgroundColor>
      <backgroundImgMode>fill</backgroundImgMode>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>30</fontSizeAuto>
      <height>107</height>
      <heightRatio>0.130647130647131</heightRatio>
      <left>-2</left>
      <leftRatio>-0.00171821305841924</leftRatio>
      <sizeRatio>0.183848797250859</sizeRatio>
      <top>80</top>
      <topRatio>0.0976800976800977</topRatio>
      <width>1105</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel4/panel10">
      <backgroundImg>2.png</backgroundImg>
      <backgroundImgMode>fill</backgroundImgMode>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>30</fontSizeAuto>
      <height>71</height>
      <heightRatio>0.663551401869159</heightRatio>
      <left>34</left>
      <leftRatio>0.0309278350515464</leftRatio>
      <sizeRatio>0.127468581687612</sizeRatio>
      <top>23</top>
      <topRatio>0.214953271028037</topRatio>
      <width>1058</width>
      <widthRatio>0.957044673539519</widthRatio>
    </control>
    <control type="LayoutY" pathname="/divRoot/layouty1">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fieldCount>2</fieldCount>
      <height>90</height>
      <heightRatio>0.10989010989011</heightRatio>
      <left>0</left>
      <sizeRatio>0.154639175257732</sizeRatio>
      <top>0</top>
      <width>1105</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutYItem" pathname="/divRoot/layouty1/layoutyitem1">
      <backgroundColor>BFCEDF</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <heavy>0</heavy>
      <height>0</height>
      <heightRatio>0.322222222222222</heightRatio>
      <left>0</left>
      <sizeRatio>0.0262443438914027</sizeRatio>
      <top>0</top>
      <width>1105</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutYItem" pathname="/divRoot/layouty1/layoutyitem2">
      <backgroundColor>47A9F9</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <fontColor>FFFFFF</fontColor>
      <fontSizeAuto>15</fontSizeAuto>
      <height>90</height>
      <heightRatio>0.677777777777778</heightRatio>
      <left>0</left>
      <sizeRatio>0.0552036199095023</sizeRatio>
      <text>填写信息</text>
      <top>0</top>
      <topRatio>0.322222222222222</topRatio>
      <width>1105</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layouty1/layoutyitem2/panel8">
      <backgroundImg>back.png</backgroundImg>
      <backgroundImgMode>fill</backgroundImgMode>
      <cursor>pointer</cursor>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>30</fontSizeAuto>
      <height>50</height>
      <heightRatio>0.557377049180328</heightRatio>
      <left>30</left>
      <leftRatio>0.0274442538593482</leftRatio>
      <sizeRatio>0.492753623188406</sizeRatio>
      <top>19</top>
      <topRatio>0.213114754098361</topRatio>
      <width>131</width>
      <widthRatio>0.118353344768439</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layouty1/layoutyitem2/panel11">
      <backgroundSkin>empty</backgroundSkin>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>84</height>
      <heightRatio>0.934426229508197</heightRatio>
      <left>2</left>
      <leftRatio>0.00198609731876862</leftRatio>
      <onClick>window.location.href = ee.pageRoot + "/loginApp/loginStudent2";
</onClick>
      <sizeRatio>0.289340101522843</sizeRatio>
      <top>1</top>
      <topRatio>0.0163934426229508</topRatio>
      <width>216</width>
      <widthRatio>0.195630585898709</widthRatio>
    </control>
  </controls>
  <taskSet count="2">
    <taskSetItem name="checkName">
      <script1><![CDATA[var name = ee.getEditText(ee.getControl("edit1"));
if (name.length<=0) {
    return;
}
eio.appendString8(name);
]]></script1>
      <script2><![CDATA[var name = eio.readString8();
var trim = function (str){ //删除左右两端的空格 
    return str.replace(/(^\s*)|(\s*$)/g, ""); 
}
name = trim(name);
while (true) {
    if (name.length<2) {
        eio.appendString8("F");
        eio.appendString8("名字必须大于2个字符的长度");
        break;
    }
    var sql = "select * from userInfo where nickName='" + db.encode(name) + "' and enabled='T'";
    var sqlResult = db.executeQuery("PJ", sql);
    if (sqlResult == null) {
        eio.appendString8("F");
        eio.appendString8("系统繁忙请稍后再试");
        break;
    }
    if (db.read(sqlResult)) {
        eio.appendString8("F");
        eio.appendString8("昵称已经存在，请换个名字");
        break;
    }
    eio.appendString8("T");
    break;
} 

]]></script2>
      <script3>if (eio.readString8()!="T") {
    alert("检测昵称失败：" + eio.readString8());
    return;
}
alert("恭喜您，这个名字可以使用");
 

</script3>
    </taskSetItem>
    <taskSetItem name="reg">
      <script1>var password1 = ee.getEditText(ee.getControl("edit2"));
var password2 = ee.getEditText(ee.getControl("edit3"));
if (password1!=password2) {
    alert("对不起，您两次输入的密码不一致，请重新输入。");
    return;
}
eio.appendString8(ee.getEditText(ee.getControl("edit1")));
eio.appendString8(password1);

</script1>
      <script2><![CDATA[var nickName = eio.readString8();
var password = eio.readString8();
var trim = function (str){ //删除左右两端的空格 
    return str.replace(/(^\s*)|(\s*$)/g, ""); 
}
nickName = trim(nickName);
password = trim(password);
//用户端输入检测
if (nickName.length<2) {
    eio.appendString8("F");
    eio.appendString8("名字必须大于2个字符的长度");
    return;
}  
if (nickName.length>10) {
    eio.appendString8("F");
    eio.appendString8("名字必须小于10个字符的长度");
    return;
}
if (password.length<6) {
    eio.appendString8("F");
    eio.appendString8("密码的长度至少要6位，请重新输入");
    return;
}  
if (password.length>15) {
    eio.appendString8("F");
    eio.appendString8("密码的长度最多15位，请重新输入");
    return;
}
//检测名字是否存在
var sql = "select * from userInfo where nickName='" + db.encode(nickName) + "' and enabled='T'";
var sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
if (db.read(sqlResult)) {
    eio.appendString8("F");
    eio.appendString8("昵称已经存在，请换个名字");
    return;
}
//检测用户手机号是否存在
sql = "select * from userInfo where mobile = '" +
    db.encode(session.get("mobile")) + "' and enabled='T'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
if (db.read(sqlResult)) {
    eio.appendString8("F");
    eio.appendString8("您输入的手机号码已经被注册使用过，请通过密码找回的形式获得您以前注册的账号");
    return;
}
//检测前面的手机认证是否通过
if (session.get("mobileCheck")!="true") {
    eio.appendString8("F");
    eio.appendString8("您的手机没有通过认证，请返回上个页面重新进行一次手机验证码认证");
    return;
}
//创建用户
sql = "exec createUser '" + db.encode(session.get("mobile")) + "'";
es.logWarning(sql);
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
db.read(sqlResult);
if (db.getInt32(sqlResult, "errorCode")!=0) {
    eio.appendString8("F");
    eio.appendString8(db.getString(sqlResult, "errorString"));
    return;
}
//设置用户昵称和密码
sql = "update userInfo set " +
    "nickName = '" + db.encode(nickName) + "', " +
    "password = '" + es.getMd5(password) + "' " +
    "where mobile = '" + db.encode(session.get("mobile")) + "' and enabled='T'";
if (!db.executeNoneQuery("PJ", sql)) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}  
es.logWarning("用户注册成功：" + session.get("mobile"));  
//插入userTree表
sql="select * from userInfo where mobile = '" + db.encode(session.get("mobile")) + "' and enabled='T'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
db.read(sqlResult);
var uid=db.getString(sqlResult,"id");  
es.logWarning(sql);
es.logWarning(uid);

sql="select * from userTree where userId="+db.encode(session.get("parentId"));
sqlResult = db.executeQuery("PJ", sql);  
db.read(sqlResult); 
var path=db.getString(sqlResult,"path");
if(path.length <=0){
    var pathNew="/"+path+db.encode(session.get("parentId"))+"/"; 
}
else {
    var pathNew=path+db.encode(session.get("parentId"))+"/"; 
} 
var a=session.get("parentId")
es.logWarning(sql);  
es.logWarning(pathNew); 
es.logWarning(a);      

sql = "insert into userTree(userId,parentUserId,path) values('"+uid+"','"+db.encode(session.get("parentId"))+"','"+pathNew+"')";
if (!db.executeNoneQuery("PJ", sql)) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
es.logWarning(sql);

//login
sql = "exec login '" + db.encode(session.get("mobile")) + "'," +
    "'" + es.getMd5(password) + "'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
db.read(sqlResult);
if (db.getInt32(sqlResult, "errorCode")!=0) {
    eio.appendString8("F");
    es.logWarning("失败："+db.getString(sqlResult, "errorString"));
    eio.appendString8(db.getString(sqlResult, "errorString"));
    es.logWarning("用户登录失败,username=" + session.get("mobile") + ",password=" + password);
    return;
} 
eio.appendString8("T");
eio.appendString8(db.getString(sqlResult, "errorString"));
es.logCommon("用户登录：" + session.get("mobile"));
]]></script2>
      <script3>if (eio.readString8()!="T") {
    alert("注册用户失败：" + eio.readString8());
    return;
}
//获取令牌
eb.setCookie("pjToken", eio.readString8());  
window.location.href = ee.pageRoot + "/loginApp/downLoadApp";

</script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>