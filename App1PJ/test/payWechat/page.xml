<page>
  <controls count="4">
    <control type="DivRoot" pathname="/divRoot">
      <left>0</left>
      <top>0</top>
      <width>1035</width>
      <height>819</height>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <backgroundColor>ffffff</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
    </control>
    <control type="Panel" pathname="/divRoot/panel1">
      <left>66</left>
      <top>41</top>
      <width>249</width>
      <height>48</height>
      <leftRatio>0.063768115942029</leftRatio>
      <topRatio>0.0500610500610501</topRatio>
      <widthRatio>0.240579710144928</widthRatio>
      <heightRatio>0.0586080586080586</heightRatio>
      <sizeRatio>0.192771084337349</sizeRatio>
      <backgroundSkin>skin1002</backgroundSkin>
      <text>微信支付测试</text>
      <fontColor>FFFFFF</fontColor>
      <cursor>pointer</cursor>
      <onClick>getUrlWechat();
</onClick>
    </control>
    <control type="Panel" pathname="/divRoot/panel2">
      <left>67</left>
      <top>103</top>
      <width>414</width>
      <height>466</height>
      <leftRatio>0.0647342995169082</leftRatio>
      <topRatio>0.125763125763126</topRatio>
      <widthRatio>0.4</widthRatio>
      <heightRatio>0.568986568986569</heightRatio>
      <sizeRatio>1.1256038647343</sizeRatio>
      <backgroundSkin>line3</backgroundSkin>
      <text>.</text>
      <hAlign>left</hAlign>
    </control>
    <control type="Panel" pathname="/divRoot/panel3">
      <left>488</left>
      <top>103</top>
      <width>414</width>
      <height>466</height>
      <leftRatio>0.471497584541063</leftRatio>
      <topRatio>0.125763125763126</topRatio>
      <widthRatio>0.4</widthRatio>
      <heightRatio>0.568986568986569</heightRatio>
      <sizeRatio>1.1256038647343</sizeRatio>
      <backgroundSkin>line3</backgroundSkin>
      <text>.</text>
      <hAlign>left</hAlign>
    </control>
  </controls>
  <taskSet count="1">
    <taskSetItem name="getUrlWechat">
      <script1 />
      <script2><![CDATA[var result = "";
var name = new Array();
var value = new Array();
name.push("appid"); //微信开放平台审核通过的应用APPID
value.push("wx9b5794aacbbdf257");
//name.push("attach"); //选填,附加数据，在查询API和支付通知中原样返回，该字段主要用于商户携带订单的自定义数据
//value.push("");
name.push("body"); //商品或支付单简要描述
value.push("1陪驾App充值");
//name.push("detail"); //选填,商品名称明细列表 
//value.push("");
//name.push("device_info"); //选填,终端设备号(门店号或收银设备ID)，默认请传"WEB"
//value.push("WEB");
//name.push("fee_type"); //选填,货币类型,符合ISO 4217标准的三位字母代码，默认人民币：CNY，其他值列表详见货币类型
//value.push("CNY");
name.push("mch_id"); //微信支付分配的商户号
value.push("1264325101");
name.push("nonce_str"); //随机字符串，不长于32位。推荐随机数生成算法
value.push("123456abcd");
name.push("notify_url"); //接收微信支付异步通知回调地址，通知url必须为直接可访问的url，不能携带参数。 
value.push("http://m.1peijia.com:88");
name.push("out_trade_no"); //商户系统内部的订单号,32个字符内、可包含字母, 其他说明见商户订单号
value.push("201603291653027778");
name.push("spbill_create_ip"); //用户端实际ip
value.push("123.12.12.123");
name.push("total_fee"); //订单总金额，单位为分，详见支付金额
value.push("1");
name.push("trade_type"); //支付类型
value.push("APP");
//交易起始时间 time_start 否 String(14) 20091225091010 订单生成时间，格式为yyyyMMddHHmmss，如2009年12月25日9点10分10秒表示为20091225091010。其他详见时间规则 
//交易结束时间 time_expire 否 String(14) 20091227091010 订单失效时间，格式为yyyyMMddHHmmss，如2009年12月27日9点10分10秒表示为20091227091010。其他详见时间规则
//注意：最短失效时间间隔必须大于5分钟 
//商品标记 goods_tag 否 String(32) WXG 商品标记，代金券或立减优惠功能的参数，说明详见代金券或立减优惠 
//指定支付方式 limit_pay 否 String(32) no_credit no_credit--指定不能使用信用卡支付 

//签名 sign 是 String(32) C380BEC2BFD727A4B6845133519F3AD6 签名，详见签名生成算法 

//产生签名
var makeSign = function() {
    var i;
    var s = "";
    for (i=0; i<name.length; i++) {
        if (i != 0) s += "&amp;";
        s += name[i] + "=" + value[i];
    }
    s += "&amp;key=YIpeijia123456789012345678901234";
    var sign = es.getMd5(s).toUpperCase();
    name.push("sign");
    value.push(sign);
}
makeSign();
//产生post字串
var makePost = function() {
    var p = "";
    p="<xml>\n";
    for (i=0; i<name.length; i++) {
        p += "   <" + name[i] + ">" + value[i] + "</" + name[i] + ">\n";
    }
    p += "</xml>";
    return p;
}
var postData = makePost();
var r = es.post("https://api.mch.weixin.qq.com/pay/unifiedorder", postData);
//获取payid
var search = "<prepay_id><![CDATA[";
var sp = r.indexOf(search);
if (sp<0) {
    eio.appendString16("F");
    eio.appendString16("微信支付失败");
    return;
}
var start = sp + search.length;
sp = r.indexOf("]]", start);
if (sp<0) {
    eio.appendString16("F");
    eio.appendString16("微信支付失败");
    return;
}
var payid = r.substr(start, sp - start);
eio.appendString16(r);
//二次请求页面
name = new Array();
value = new Array();
name.push("appid"); //应用ID,微信开放平台审核通过的应用APPID
value.push("wx9b5794aacbbdf257");
name.push("noncestr"); //随机字符串,随机字符串，不长于32位。推荐随机数生成算法 
value.push("201603311114337777");
name.push("package"); //扩展字段,暂填写固定值Sign=WXPay 
value.push("Sign=WXPay");
name.push("partnerid"); //商户号,微信支付分配的商户号
value.push("1264325101");
name.push("prepayid"); //预支付交易会话ID,微信返回的支付交易会话ID 
value.push(payid);
name.push("timestamp"); //时间戳 timestamp String(10) 是 1412000000 时间戳，请见接口规则-参数规定 
value.push("2123456789"); 
makeSign();
postData = makePost();
r = es.post("https://api.mch.weixin.qq.com/pay/unifiedorder", postData);
eio.appendString16(postData + r);

]]></script2>
      <script3><![CDATA[var r1 = eio.readString16();
var r2 = eio.readString16();
ee.setText(ee.getControl("panel2"), r1.replace(/</g,"&amp;lt;").replace(/>/g,"&amp;gt;"));
ee.setText(ee.getControl("panel3"), r2.replace(/</g,"&amp;lt;").replace(/>/g,"&amp;gt;"));

]]></script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>