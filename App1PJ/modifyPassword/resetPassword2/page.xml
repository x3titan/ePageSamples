<page>
  <controls count="9">
    <control type="DivRoot" pathname="/divRoot">
      <left>0</left>
      <top>0</top>
      <width>681</width>
      <height>819</height>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <backgroundColor>F3F3F3</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
    </control>
    <control type="Panel" pathname="/divRoot/panel9">
      <left>0</left>
      <top>0</top>
      <width>681</width>
      <height>75</height>
      <widthRatio>1</widthRatio>
      <heightRatio>0.0915750915750916</heightRatio>
      <sizeRatio>0.110132158590308</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundColor>47A9F9</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <text>设置新密码</text>
      <fontSizeAuto>20</fontSizeAuto>
      <fontColor>FFFFFF</fontColor>
      <fontBold>true</fontBold>
      <layerVisible>false</layerVisible>
    </control>
    <control type="Panel" pathname="/divRoot/panel9/panel4">
      <left>8</left>
      <top>17</top>
      <width>90</width>
      <height>39</height>
      <leftRatio>0.0117474302496329</leftRatio>
      <topRatio>0.226666666666667</topRatio>
      <widthRatio>0.13215859030837</widthRatio>
      <heightRatio>0.52</heightRatio>
      <sizeRatio>0.433333333333333</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundImg>back.png</backgroundImg>
      <backgroundImgMode>fill</backgroundImgMode>
      <fontSizeAuto>30</fontSizeAuto>
      <cursor>pointer</cursor>
      <onClick>window.location.href = ee.pageRoot + "/modifyPassword/resetPassword1";
</onClick>
    </control>
    <control type="Panel" pathname="/divRoot/panel5">
      <left>23</left>
      <top>164</top>
      <width>628</width>
      <height>294</height>
      <leftRatio>0.0337738619676946</leftRatio>
      <topRatio>0.2002442002442</topRatio>
      <widthRatio>0.922173274596182</widthRatio>
      <heightRatio>0.358974358974359</heightRatio>
      <sizeRatio>0.468152866242038</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundSkin>body4</backgroundSkin>
      <fontSizeAuto>20</fontSizeAuto>
      <fontColor>FFFFFF</fontColor>
      <aniAlpha>whiteAlpha:白色淡出</aniAlpha>
    </control>
    <control type="Panel" pathname="/divRoot/panel5/panel1">
      <left>69</left>
      <top>71</top>
      <width>151</width>
      <height>51</height>
      <leftRatio>0.109872611464968</leftRatio>
      <topRatio>0.241496598639456</topRatio>
      <widthRatio>0.240445859872611</widthRatio>
      <heightRatio>0.173469387755102</heightRatio>
      <sizeRatio>0.337748344370861</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <text>新密码</text>
      <fontSizeAuto>25</fontSizeAuto>
    </control>
    <control type="Edit" pathname="/divRoot/panel5/edit1">
      <left>230</left>
      <top>74</top>
      <width>320</width>
      <height>45</height>
      <leftRatio>0.366071428571429</leftRatio>
      <topRatio>0.250825082508251</topRatio>
      <widthRatio>0.508928571428571</widthRatio>
      <heightRatio>0.151815181518152</heightRatio>
      <sizeRatio>0.201754385964912</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundSkin>line3</backgroundSkin>
      <inputPassword>true</inputPassword>
      <inputFontSizeAuto>20</inputFontSizeAuto>
    </control>
    <control type="Panel" pathname="/divRoot/panel5/panel2">
      <left>73</left>
      <top>139</top>
      <width>151</width>
      <height>51</height>
      <leftRatio>0.116242038216561</leftRatio>
      <topRatio>0.472789115646259</topRatio>
      <widthRatio>0.240445859872611</widthRatio>
      <heightRatio>0.173469387755102</heightRatio>
      <sizeRatio>0.337748344370861</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <text>再输入一
次新密码</text>
      <fontSizeAuto>35</fontSizeAuto>
    </control>
    <control type="Edit" pathname="/divRoot/panel5/edit2">
      <left>230</left>
      <top>142</top>
      <width>320</width>
      <height>45</height>
      <leftRatio>0.366071428571429</leftRatio>
      <topRatio>0.481848184818482</topRatio>
      <widthRatio>0.508928571428571</widthRatio>
      <heightRatio>0.151815181518152</heightRatio>
      <sizeRatio>0.201754385964912</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundSkin>line3</backgroundSkin>
      <inputPassword>true</inputPassword>
      <inputFontSizeAuto>20</inputFontSizeAuto>
    </control>
    <control type="Panel" pathname="/divRoot/panel8">
      <left>117</left>
      <top>671</top>
      <width>431</width>
      <height>51</height>
      <leftRatio>0.171806167400881</leftRatio>
      <topRatio>0.819291819291819</topRatio>
      <widthRatio>0.632892804698972</widthRatio>
      <heightRatio>0.0622710622710623</heightRatio>
      <sizeRatio>0.118329466357309</sizeRatio>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <backgroundSkin>button3</backgroundSkin>
      <text>确 定</text>
      <fontSizeAuto>20</fontSizeAuto>
      <fontColor>FFFFFF</fontColor>
      <cursor>pointer</cursor>
      <onClick>modifyPassword();</onClick>
    </control>
  </controls>
  <taskSet count="2">
    <taskSetItem name="modifyPassword">
      <script1><![CDATA[var password1 = ee.getEditText(ee.getControl("edit1"));
var password2 = ee.getEditText(ee.getControl("edit2"));
if (password1.length < 6) {
    alert("新密码的长度至少需要6位，请重新输入");
    return;
}
if (password1 != password2) {
    alert("对不起，您两次输入的密码不一致，请重新输入。");
    return;
} 
eio.appendString8(password1);

]]></script1>
      <script2>if (session.get("mobileCheck") != "true") {
    eio.appendString8("F");
    eio.appendString8("没有通过手机验证");
    return;
}
var mobile = session.get("mobile");
if (mobile.length!=11) {
    eio.appendString8("F");
    eio.appendString8("没有通过手机验证");
    return;
}
session.set("mobileCheck", "false"); //手机验证仅一次有效

var password = eio.readString8();
var passwordMd5 = es.getMd5(password);
var sql,sqlResult;
sql = "update userInfo set password = '" + 
    db.encode(passwordMd5) + 
    "' where mobile='" + db.encode(mobile) + "'";
var sqlResult = db.executeNoneQuery("PJ", sql);
if (!sqlResult) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}

eio.appendString8("T");
eio.appendString8(mobile);
</script2>
      <script3>if (eio.readString8()!="T") {
    alert("无法修改密码：" + eio.readString8());
    return;
}
g5.username = eio.readString8();
alert("密码修改成功，请牢记您的新密码");
login();

</script3>
    </taskSetItem>
    <taskSetItem name="login">
      <script1>g5.password = ee.getEditText(ee.getControl("edit1"));
eio.appendString8(g5.username);
eio.appendString8(g5.password);

</script1>
      <script2>var username = eio.readString8();
var password = eio.readString8();
var passwordMd5 = es.getMd5(password);
var sql,sqlResult;
sql = "exec login '" + db.encode(username) + "'," +
    "'" + passwordMd5 + "'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    eio.appendString8("系统繁忙请稍后再试");
    return;
}
db.read(sqlResult);
if (db.getInt32(sqlResult, "errorCode")!=0) {
    eio.appendString8("F");
    eio.appendString8(db.getString(sqlResult, "errorString"));
    es.logCommon("用户登录失败,username=" + username + ",password=" + password);
    return;
} 
eio.appendString8("T");
eio.appendString8(db.getString(sqlResult, "errorString"));
es.logCommon("用户通过密码找回登录：" + username);
</script2>
      <script3>if (eio.readString8()!="T") {
    alert("登录失败：" + eio.readString8());
    window.location.href = ee.pageRoot + "/login";
    return;
}
//获取令牌
eb.setCookie("pjToken", eio.readString8());  

window.location.href = ee.pageRoot + "/login";



</script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>