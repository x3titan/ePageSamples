<page>
  <controls count="22">
    <control type="DivRoot" pathname="/divRoot">
      <backgroundColor>FFFFFF</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>816</height>
      <left>0</left>
      <onControlLoad>var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
if (!isIOS) {
    ee.getControl("layoutyitem1").heavy = 0;
}
setTimeout(function(){
    ee.autoResize = false;
},1000);  
 

getSession();
getMobile();
    
var flag=1;
var wait=60;                               
function time(o) { 
       var mobile = ee.getText(ee.getControl("panel2"));
            //手机号码检测
           if (mobile.length!=11) {
               alert("对不起，您输入的不是一个有效的手机号码");
               return;
           }
           if (!(/^\d+$/.test(mobile))) {
               alert("对不起，您输入的不是一个有效的手机号码");
               return;
        }   
        if (wait == 0) {  
            ee.setVisible(ee.getControl("panel5"),false);             
            ee.getControl(o).removeAttribute("disabled");           
            ee.setText(ee.getControl(o),"获取验证码");  
            ee.setTextColor(ee.getControl(o),"rgb(71, 169, 249)") 
            wait = 60;  
            flag=1;
        } else {    
            if(flag==1){
               getSmsCode();;
            }    
            flag=0;
            ee.setVisible(ee.getControl("panel5"),true); 
            ee.getControl(o).setAttribute("disabled", true);  
            ee.setText(ee.getControl(o),"重新发送(" + wait + ")");   
            ee.setTextColor(ee.getControl(o),"rgb(181, 181, 181)")
            wait--;  
            setTimeout(function() {  
                time(o)  
            },  
            1000)  
        }  
    }  
 
ee.setOnClick(ee.getControl("layoutxitem5"),function(){time("layoutxitem5");});</onControlLoad>
      <pageHead><![CDATA[<meta name="viewport" content="width=device-width, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="format-detection" content="telephone=no"/>]]></pageHead>
      <top>0</top>
      <width>428</width>
    </control>
    <control type="Panel" pathname="/divRoot/panel8">
      <backgroundImg>btnNext.gif</backgroundImg>
      <cursor>pointer</cursor>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontColor>FFFFFF</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>20</fontSizeAuto>
      <height>60</height>
      <heightRatio>0.0735294117647059</heightRatio>
      <left>13</left>
      <leftRatio>0.0303738317757009</leftRatio>
      <onClick>checkSmsCode();
</onClick>
      <sizeRatio>0.149625935162095</sizeRatio>
      <top>298</top>
      <topRatio>0.365196078431373</topRatio>
      <width>401</width>
      <widthRatio>0.936915887850467</widthRatio>
    </control>
    <control type="LayoutY" pathname="/divRoot/layouty1">
      <dockX>fill</dockX>
      <dockY>ratio</dockY>
      <fieldCount>2</fieldCount>
      <height>90</height>
      <heightRatio>0.10989010989011</heightRatio>
      <left>0</left>
      <sizeRatio>0.204081632653061</sizeRatio>
      <top>-1</top>
      <topRatio>-0.00122100122100122</topRatio>
      <width>428</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutYItem" pathname="/divRoot/layouty1/layoutyitem1">
      <backgroundColor>BFCEDF</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <heavy>47</heavy>
      <height>29</height>
      <heightRatio>0.322222222222222</heightRatio>
      <left>0</left>
      <sizeRatio>0.0467741935483871</sizeRatio>
      <top>0</top>
      <width>428</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutYItem" pathname="/divRoot/layouty1/layoutyitem2">
      <backgroundColor>47A9F9</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <fontColor>FFFFFF</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>15</fontSizeAuto>
      <height>61</height>
      <heightRatio>0.677777777777778</heightRatio>
      <left>0</left>
      <sizeRatio>0.0983870967741936</sizeRatio>
      <text>忘记密码</text>
      <top>29</top>
      <topRatio>0.322222222222222</topRatio>
      <width>428</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layouty1/layoutyitem2/panel89">
      <backgroundImg>back.gif</backgroundImg>
      <backgroundImgMode>fill</backgroundImgMode>
      <cursor>pointer</cursor>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontSizeAuto>30</fontSizeAuto>
      <height>34</height>
      <heightRatio>0.557377049180328</heightRatio>
      <left>12</left>
      <leftRatio>0.0280373831775701</leftRatio>
      <sizeRatio>0.666666666666667</sizeRatio>
      <top>13</top>
      <topRatio>0.213114754098361</topRatio>
      <width>51</width>
      <widthRatio>0.119158878504673</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layouty1/layoutyitem2/panel90">
      <backgroundSkin>empty</backgroundSkin>
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>57</height>
      <heightRatio>0.934426229508197</heightRatio>
      <left>1</left>
      <leftRatio>0.00157728706624606</leftRatio>
      <onClick>
if(eb.getCookie("pjUserType")){   
    //eb.delCookie("pwd");
    if (eb.getCookie("pjUserType")=="教练") {  
        window.location.href = ee.pageRoot + "/modifyPassword/setCoach";
    } 
    else {  
        window.location.href = ee.pageRoot + "/modifyPassword";
    }
}  
else {  
    //eb.delCookie("pwd");
    window.location.href = ee.pageRoot + "/logincCon"; 
}
</onClick>
      <sizeRatio>0.22007722007722</sizeRatio>
      <top>1</top>
      <topRatio>0.0163934426229508</topRatio>
      <width>175</width>
      <widthRatio>0.408517350157729</widthRatio>
    </control>
    <control type="LayoutX" pathname="/divRoot/layoutx1">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fieldCount>1</fieldCount>
      <height>53</height>
      <heightRatio>0.0649509803921569</heightRatio>
      <left>13</left>
      <leftRatio>0.0314606741573034</leftRatio>
      <sizeRatio>0.127098321342926</sizeRatio>
      <top>116</top>
      <topRatio>0.142156862745098</topRatio>
      <width>401</width>
      <widthRatio>0.937078651685393</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/layoutx1/layoutxitem1">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontColor>505050</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <hAlign>left</hAlign>
      <heavy>80</heavy>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.0912220309810671</sizeRatio>
      <text>手机号码　</text>
      <top>0</top>
      <width>401</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx1/layoutxitem1/panel1">
      <backgroundColor>C0C0C0</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>bottom</dockY>
      <height>1</height>
      <heightRatio>0.0188679245283019</heightRatio>
      <left>0</left>
      <sizeRatio>0.00172117039586919</sizeRatio>
      <top>52</top>
      <topRatio>0.981132075471698</topRatio>
      <width>401</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx1/layoutxitem1/panel2">
      <dockX>ratio</dockX>
      <dockY>fill</dockY>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <hAlign>left</hAlign>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <layerName>mobile</layerName>
      <left>126</left>
      <leftRatio>0.314553990610329</leftRatio>
      <sizeRatio>0.185314685314685</sizeRatio>
      <text>1</text>
      <top>0</top>
      <width>269</width>
      <widthRatio>0.671361502347418</widthRatio>
    </control>
    <control type="LayoutX" pathname="/divRoot/layoutx2">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>53</height>
      <heightRatio>0.0647130647130647</heightRatio>
      <left>13</left>
      <leftRatio>0.0310421286031042</leftRatio>
      <sizeRatio>0.125295508274232</sizeRatio>
      <top>185</top>
      <topRatio>0.227106227106227</topRatio>
      <width>401</width>
      <widthRatio>0.937915742793792</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/layoutx2/layoutxitem3">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontColor>505050</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <hAlign>left</hAlign>
      <heavy>140</heavy>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.292817679558011</sizeRatio>
      <text>短信验证码　</text>
      <top>0</top>
      <width>125</width>
      <widthRatio>0.310996563573883</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx2/layoutxitem3/panel4">
      <backgroundColor>C0C0C0</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>bottom</dockY>
      <height>1</height>
      <heightRatio>0.0188679245283019</heightRatio>
      <left>0</left>
      <sizeRatio>0.00552486187845304</sizeRatio>
      <top>52</top>
      <topRatio>0.981132075471698</topRatio>
      <width>125</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/layoutx2/layoutxitem4">
      <backgroundColor>d0d0d0</backgroundColor>
      <heavy>150</heavy>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <left>125</left>
      <leftRatio>0.310996563573883</leftRatio>
      <sizeRatio>0.27319587628866</sizeRatio>
      <top>0</top>
      <width>133</width>
      <widthRatio>0.333333333333333</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/layoutx2/layoutxitem4/edit2">
      <backgroundSkin>empty</backgroundSkin>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <fontColor>B5B5B5</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <hAlign>left</hAlign>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <inputFont>黑体</inputFont>
      <inputFontSize>30</inputFontSize>
      <inputFontSizeAuto>20</inputFontSizeAuto>
      <left>0</left>
      <sizeRatio>0.27319587628866</sizeRatio>
      <text>请输入验证码</text>
      <top>0</top>
      <width>133</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx2/layoutxitem4/edit2/panel6">
      <backgroundColor>C0C0C0</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>bottom</dockY>
      <height>1</height>
      <heightRatio>0.0188679245283019</heightRatio>
      <left>0</left>
      <sizeRatio>0.00515463917525773</sizeRatio>
      <top>52</top>
      <topRatio>0.981132075471698</topRatio>
      <width>133</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="LayoutXItem" pathname="/divRoot/layoutx2/layoutxitem5">
      <backgroundColor>f0f0f0</backgroundColor>
      <fontColor>47A9F9</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <heavy>160</heavy>
      <height>53</height>
      <heightRatio>1</heightRatio>
      <left>258</left>
      <leftRatio>0.644329896907217</leftRatio>
      <sizeRatio>0.256038647342995</sizeRatio>
      <text>获取验证码</text>
      <top>0</top>
      <width>143</width>
      <widthRatio>0.355670103092784</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx2/layoutxitem5/panel7">
      <backgroundColor>C0C0C0</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>bottom</dockY>
      <height>1</height>
      <heightRatio>0.0188679245283019</heightRatio>
      <left>0</left>
      <sizeRatio>0.00483091787439614</sizeRatio>
      <top>52</top>
      <topRatio>0.981132075471698</topRatio>
      <width>143</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/layoutx2/layoutxitem5/panel9">
      <backgroundColor>B6B6B6</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>left</dockX>
      <dockY>ratio</dockY>
      <height>39</height>
      <heightRatio>0.731707317073171</heightRatio>
      <left>0</left>
      <sizeRatio>30</sizeRatio>
      <top>6</top>
      <topRatio>0.121951219512195</topRatio>
      <width>1</width>
      <widthRatio>0.00632911392405063</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel3">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <fontColor>B5B5B5</fontColor>
      <fontFamily>黑体</fontFamily>
      <fontSizeAuto>22</fontSizeAuto>
      <hAlign>left</hAlign>
      <height>44</height>
      <heightRatio>0.0537240537240537</heightRatio>
      <left>12</left>
      <leftRatio>0.0288248337028825</leftRatio>
      <sizeRatio>0.104018912529551</sizeRatio>
      <text>请输入您的手机号码，用以验证您的手机</text>
      <top>248</top>
      <topRatio>0.304029304029304</topRatio>
      <width>401</width>
      <widthRatio>0.937915742793792</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel5">
      <dockX>ratio</dockX>
      <dockY>ratio</dockY>
      <height>62</height>
      <heightRatio>0.0757020757020757</heightRatio>
      <layerName>遮罩</layerName>
      <layerVisible>false</layerVisible>
      <left>287</left>
      <leftRatio>0.670305676855895</leftRatio>
      <sizeRatio>0.452554744525547</sizeRatio>
      <top>168</top>
      <topRatio>0.206349206349206</topRatio>
      <width>128</width>
      <widthRatio>0.299126637554585</widthRatio>
    </control>
  </controls>
  <taskSet count="4">
    <taskSetItem name="getSmsCode">
      <script1>//var mobile = ee.getEditText(ee.getControl("edit1"));
 var mobile = ee.getText(ee.getControl("panel2"));
eio.appendString8(mobile);</script1>
      <script2><![CDATA[var mobile = eio.readString8();
while (true) {
    //后台手机号验证
    if (mobile.length!=11) {
        eio.appendString8("F");
        eio.appendString8("手机号非法");
        break;
    }
    if (!(/^\d+$/.test(mobile))) {
        eio.appendString8("F");
        eio.appendString8("手机号非法");
        break;
    }
    //产生验证码
    var code = 0;
    var seed = (new Date()).getTime();
    while (code<1000) {
        seed = ( seed * 9301 + 49297 ) % 233280;
        var rand = seed / 233280.0;
        code = Math.floor(rand * 10000);
    }
    //存储验证码和手机号
    session.set("mobileCode", code + "");
    session.set("mobile", mobile);
    
    //发送验证码
    var sql = "insert into sms (mobile, message) values (" +
        "'" + db.encode(mobile) + "'," +
        "'您的验证码是：" + code + "')";
    if (!db.executeNoneQuery("PJ", sql)) {
        eio.appendString8("F");
        eio.appendString8("系统繁忙请稍后再试");
        break;
    } 
    eio.appendString8("T"); 
    eio.appendString8(session.get("mobileCode"));
    break;
}
              ]]></script2>
      <script3>if (eio.readString8()!="T") {
    alert("发送验证码失败：" + eio.readString8());
    return;
} 
console.log("mobileCode="+eio.readString8());
alert("验证码已经以短信的形式发送到您的手机上，请注意查收。验证码是一个4位的数字，请将它填写在下面的栏目中");

</script3>
    </taskSetItem>
    <taskSetItem name="getSession">
      <script1 />
      <script2>eio.appendString8(session.get("pwd"));</script2>
      <script3>var s=eio.readString8(); 
if(s=="pwd"){
    ee.setText(ee.getControl("layoutyitem2"),"重置密码");
}</script3>
    </taskSetItem>
    <taskSetItem name="getMobile">
      <script1>eio.appendString8(eb.getCookie("pjToken"));</script1>
      <script2><![CDATA[var sql,sqlResult;
var token = eio.readString8();
sql = "exec getUserInfoBySession '" + db.encode(token) + "'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    es.logWarning("数据库执行错误, sql=" + sql);
    return;
}
db.read(sqlResult);
if (db.getString(sqlResult, "sessionId").length < 5) {
    eio.appendString8("F");
    es.logWarning("用户token失效, sql=" + sql);
    return;
} 
var mobile = db.getString(sqlResult,"mobile") 
eio.appendString8("T");
eio.appendString8(mobile); 

session.set("codeFlag11",0); //标记用于 checkSmsCode 事务]]></script2>
      <script3>var code = eio.readString8();
if (code != "T"){
    alert("获取用户手机号失败"); 
    return;
}

var mobile = eio.readString8("mobile");
console.log("mobile="+mobile);
ee.setText(ee.getControl("panel2"),mobile);
ee.setVisible(ee.getControl("panel2"),true); 
//alert("1");

//ee.setOnClick(ee.getControl("layoutxitem5"),function(){time("layoutxitem5");});</script3>
    </taskSetItem>
    <taskSetItem name="checkSmsCode">
      <script1>var mobileCode = ee.getEditText(ee.getControl("edit2"));
eio.appendString8(mobileCode);
</script1>
      <script2><![CDATA[var mobileCode = eio.readString8();
while (true) {
    var mobileCodeS = session.get("mobileCode");
    if (mobileCodeS.length<=0) {
        eio.appendString8("F");
        eio.appendString8("请点击发送按钮，收到短信后填写验证码");
        break;
    }
    /*
    if (mobileCodeS!=mobileCode) {
        session.set("mobileCode", "");
        eio.appendString8("F");
        eio.appendString8("您输入的验证码不正确，请重新发送并输入一次验证码");
        break;
    }*/
    
    if(mobileCodeS!=mobileCode){
        var flag = session.get("codeFlag11"); 
       //  eio.appendString8("flag::"+flag);
        flag = parseInt(flag)+1;
       // flag +=1;  
       //  eio.appendString8("flag++::"+flag);
        session.set("codeFlag11",flag);
        eio.appendString8("F"); 
        
        if(flag ==1){
           eio.appendString8("输入的验证码不正确，您还有 2 次机会重新输入验证码");
        }else if(flag ==2){
           eio.appendString8("输入的验证码不正确，您还有 1 次机会重新输入验证码");
        }else if(flag ==3){
            session.set("codeFlag11",0);           
            session.set("mobileCode",""); 
            eio.appendString8("您输入的验证码不正确，请重新获取并输入验证码");
        } 
        //eio.appendString8(mobileCodeS);
       // eio.appendString8(mobileCode);
        break;
        
    }    
    eio.appendString8("T"); 
    //eio.appendString8(mobileCodeS);
    //eio.appendString8(mobileCode);
    session.set("mobileCheck", "true");
    break;
}
]]></script2>
      <script3>if (eio.readString8()!="T") { 
    
    alert("验证失败：" + eio.readString8()); 
    console.log("codeS="+ eio.readString8());
    console.log("code="+eio.readString8());
    
    return;
} 
    //console.log("codeS11="+ eio.readString8());
    //console.log("code11="+eio.readString8());
eb.setCookie("logined","T");
window.location.href = ee.pageRoot + "/modifyPassword/resetPassword2";

 
</script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>