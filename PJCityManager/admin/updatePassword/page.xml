<page>
  <controls count="9">
    <control type="DivRoot" pathname="/divRoot">
      <backgroundColor>ffffff</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>816</height>
      <left>0</left>
      <top>0</top>
      <width>1257</width>
    </control>
    <control type="Panel" pathname="/divRoot/panel1">
      <backgroundColor>D6D3CE</backgroundColor>
      <backgroundImg>xz_bn.png</backgroundImg>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <height>816</height>
      <heightRatio>1</heightRatio>
      <left>0</left>
      <sizeRatio>0.649164677804296</sizeRatio>
      <top>0</top>
      <width>1257</width>
      <widthRatio>1</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel1/panel2">
      <aniAlpha>appear:渐变出现</aniAlpha>
      <backgroundColor>F0F0F0</backgroundColor>
      <backgroundSkin>edit2</backgroundSkin>
      <dockX>center</dockX>
      <dockY>center</dockY>
      <height>349</height>
      <heightRatio>0.427696078431373</heightRatio>
      <left>277</left>
      <leftRatio>0.220365950676213</leftRatio>
      <sizeRatio>0.497150997150997</sizeRatio>
      <top>233</top>
      <topRatio>0.285539215686274</topRatio>
      <width>702</width>
      <widthRatio>0.558472553699284</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel1/panel2/panel4">
      <fontBold>true</fontBold>
      <fontColor>198D8D</fontColor>
      <fontSize>13</fontSize>
      <hAlign>right</hAlign>
      <height>40</height>
      <heightRatio>0.114613180515759</heightRatio>
      <left>119</left>
      <leftRatio>0.16951566951567</leftRatio>
      <sizeRatio>0.307692307692308</sizeRatio>
      <text>新密码</text>
      <top>94</top>
      <topRatio>0.269340974212034</topRatio>
      <width>130</width>
      <widthRatio>0.185185185185185</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/panel1/panel2/edit2">
      <backgroundSkin>edit2</backgroundSkin>
      <fontBold>true</fontBold>
      <fontColor>C0C0C0</fontColor>
      <fontSize>11</fontSize>
      <height>36</height>
      <heightRatio>0.103151862464183</heightRatio>
      <inputFontColor>404040</inputFontColor>
      <inputFontSize>13</inputFontSize>
      <inputPassword>true</inputPassword>
      <left>290</left>
      <leftRatio>0.413105413105413</leftRatio>
      <sizeRatio>0.133333333333333</sizeRatio>
      <text>请输入新密码</text>
      <top>96</top>
      <topRatio>0.275071633237822</topRatio>
      <width>270</width>
      <widthRatio>0.384615384615385</widthRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel1/panel2/panel5">
      <fontBold>true</fontBold>
      <fontColor>198D8D</fontColor>
      <fontSize>13</fontSize>
      <hAlign>right</hAlign>
      <height>40</height>
      <heightRatio>0.114613180515759</heightRatio>
      <left>119</left>
      <leftRatio>0.16951566951567</leftRatio>
      <sizeRatio>0.307692307692308</sizeRatio>
      <text>确认密码</text>
      <top>152</top>
      <topRatio>0.435530085959885</topRatio>
      <width>130</width>
      <widthRatio>0.185185185185185</widthRatio>
    </control>
    <control type="Edit" pathname="/divRoot/panel1/panel2/edit3">
      <backgroundSkin>edit2</backgroundSkin>
      <fontBold>true</fontBold>
      <fontColor>C0C0C0</fontColor>
      <fontSize>11</fontSize>
      <height>36</height>
      <heightRatio>0.103151862464183</heightRatio>
      <inputFontColor>404040</inputFontColor>
      <inputFontSize>13</inputFontSize>
      <inputPassword>true</inputPassword>
      <left>290</left>
      <leftRatio>0.413105413105413</leftRatio>
      <sizeRatio>0.133333333333333</sizeRatio>
      <text>请确认密码</text>
      <top>156</top>
      <topRatio>0.446991404011461</topRatio>
      <width>270</width>
      <widthRatio>0.384615384615385</widthRatio>
    </control>
    <control type="Button" pathname="/divRoot/panel1/panel2/button1">
      <backgroundSkin>TCloud000</backgroundSkin>
      <backgroundSkin1>LRBtn7</backgroundSkin1>
      <backgroundSkin2>LRBtn7</backgroundSkin2>
      <cursor>pointer</cursor>
      <fontColor>FFEFD5</fontColor>
      <fontSize>14</fontSize>
      <height>39</height>
      <heightRatio>0.111747851002865</heightRatio>
      <left>157</left>
      <leftRatio>0.223646723646724</leftRatio>
      <onClick>ee.setEditText(ee.getControl("edit2"),"");
ee.setEditText(ee.getControl("edit3"),"");</onClick>
      <sizeRatio>0.325</sizeRatio>
      <text>取消</text>
      <top>239</top>
      <topRatio>0.684813753581662</topRatio>
      <width>120</width>
      <widthRatio>0.170940170940171</widthRatio>
    </control>
    <control type="Button" pathname="/divRoot/panel1/panel2/button2">
      <backgroundSkin>TCloud000</backgroundSkin>
      <backgroundSkin1>LRBtn7</backgroundSkin1>
      <backgroundSkin2>LRBtn7</backgroundSkin2>
      <cursor>pointer</cursor>
      <fontColor>FFEFD5</fontColor>
      <fontSize>14</fontSize>
      <height>39</height>
      <heightRatio>0.111747851002865</heightRatio>
      <left>455</left>
      <leftRatio>0.648148148148148</leftRatio>
      <onClick>update();</onClick>
      <sizeRatio>0.325</sizeRatio>
      <text>确定</text>
      <top>239</top>
      <topRatio>0.684813753581662</topRatio>
      <width>120</width>
      <widthRatio>0.170940170940171</widthRatio>
    </control>
  </controls>
  <taskSet count="1">
    <taskSetItem name="update">
      <script1><![CDATA[
var newPassword = ee.getEditText(ee.getControl("edit2")); 
var againPassword = ee.getEditText(ee.getControl("edit3"));

if(newPassword.length == 0){
    alert("密码不能为空");
    return;
}
if(newPassword.length < 6){
    alert("密码长度必须大于6");
    return;
}
if(newPassword.length > 15){
    alert("密码长度必须小于15");
    return;
}
if(newPassword !== againPassword){
      alert("两次密码必须一致!");
      return;
}

g5.token = eb.getCookie("loginToken");
eio.appendString8(g5.token);
eio.appendString8(newPassword);
]]></script1>
      <script2><![CDATA[
//1
var token = eio.readString8();
var password = eio.readString8();
var passwordMd5 = es.getMd5(password);

//2
var sql,sqlResult;
sql = "exec getUserInfoBySession '" + db.encode(token) + "'";
sqlResult = db.executeQuery("PJ", sql);
if (sqlResult == null) {
    eio.appendString8("F");
    es.logWarning("数据库执行错误, sql=" + sql);
    return;
}
db.read(sqlResult);
if (db.getString(sqlResult, "sessionId").length < 5) {
    eio.appendString8("F");
    es.logWarning("用户token失效, sql=" + sql);
    return;
}      
var id=db.getString(sqlResult,"id");

//3
sql = "update userInfo set password ='" + db.encode(passwordMd5) + "'where id='" + db.encode(id) + "'and "+"userType='城市负责人'";
sqlResult = db.executeNoneQuery("PJ", sql);
if (!sqlResult) {
    eio.appendString8("F");
    es.logWarning("修改语句执行失败，sql=" + sql);
    return;
}
eio.appendString8("T");





]]></script2>
      <script3>var x=eio.readString8();
if(x!="T"){
    alert("密码修改失败!");
}else {
    alert("密码修改成功!请重新登录");
    //setTimeout(function(){
        //window.location.href = ee.pageRoot + "../login";
      //  window.location.href = ee.getUrl("/login");
    //},2000);
}




</script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>