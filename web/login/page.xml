<page>
  <controls count="13">
    <control type="DivRoot" pathname="/divRoot">
      <left>0</left>
      <top>0</top>
      <width>1159</width>
      <height>819</height>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
      <backgroundColor>ffffff</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <hAlign>left</hAlign>
      <vAlign>bottom</vAlign>
      <onControlLoad><![CDATA[//onControlLoad
var loginSwf = "<embed width='99.9%' height='99.5%' type='application/x-shockwave-flash' wmode='transparent' quality='best'";
loginSwf += "src='eeImage.aspx?_image_Url_=/web/login/login.swf' allowscriptaccess='always' allowfullscreen='true'  name='Movie1'>";
ee.getControl("panel1").innerHTML += loginSwf;
ee.getControl("panel7").style.zIndex = 1000;
ee.setVisible(ee.getControl("panel8"), false);
onkeydown=function (e) {
    if(e.keyCode==13)login();
    //ee.setVisible(ee.getControl("panel8"), true);
}]]></onControlLoad>
    </control>
    <control type="Panel" pathname="/divRoot/panel1">
      <left>0</left>
      <top>0</top>
      <width>1159</width>
      <height>819</height>
      <widthRatio>1</widthRatio>
      <heightRatio>1</heightRatio>
      <sizeRatio>0.684010152284264</sizeRatio>
      <dockX>fill</dockX>
      <dockY>fill</dockY>
    </control>
    <control type="Panel" pathname="/divRoot/panel6">
      <left>378</left>
      <top>210</top>
      <width>403</width>
      <height>398</height>
      <leftRatio>0.326143226919758</leftRatio>
      <topRatio>0.256410256410256</topRatio>
      <widthRatio>0.347713546160483</widthRatio>
      <heightRatio>0.485958485958486</heightRatio>
      <sizeRatio>0.987593052109181</sizeRatio>
      <dockX>center</dockX>
      <dockY>center</dockY>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7">
      <left>104</left>
      <top>140</top>
      <width>286</width>
      <height>255</height>
      <leftRatio>0.258064516129032</leftRatio>
      <topRatio>0.351758793969849</topRatio>
      <widthRatio>0.709677419354839</widthRatio>
      <heightRatio>0.64070351758794</heightRatio>
      <sizeRatio>0.891608391608392</sizeRatio>
      <outerLeft>550</outerLeft>
      <outerTop>150</outerTop>
      <backgroundColor>FFFFFF</backgroundColor>
      <bgColorEnabled>true</bgColorEnabled>
      <alpha>0.5</alpha>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel3">
      <left>32</left>
      <top>42</top>
      <width>73</width>
      <height>21</height>
      <leftRatio>0.100313479623824</leftRatio>
      <topRatio>0.172131147540984</topRatio>
      <widthRatio>0.22884012539185</widthRatio>
      <heightRatio>0.0860655737704918</heightRatio>
      <sizeRatio>0.287671232876712</sizeRatio>
      <text>用户名:</text>
      <fontSize>12</fontSize>
      <layerVisible>false</layerVisible>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel2">
      <left>32</left>
      <top>85</top>
      <width>73</width>
      <height>21</height>
      <leftRatio>0.100313479623824</leftRatio>
      <topRatio>0.348360655737705</topRatio>
      <widthRatio>0.22884012539185</widthRatio>
      <heightRatio>0.0860655737704918</heightRatio>
      <sizeRatio>0.287671232876712</sizeRatio>
      <text>密　码:</text>
      <fontSize>12</fontSize>
      <layerVisible>false</layerVisible>
    </control>
    <control type="Edit" pathname="/divRoot/panel6/panel7/edit1">
      <left>112</left>
      <top>36</top>
      <width>162</width>
      <height>30</height>
      <leftRatio>0.351097178683386</leftRatio>
      <topRatio>0.147540983606557</topRatio>
      <widthRatio>0.507836990595611</widthRatio>
      <heightRatio>0.122950819672131</heightRatio>
      <sizeRatio>0.185185185185185</sizeRatio>
      <backgroundSkin>edit1</backgroundSkin>
      <layerVisible>false</layerVisible>
    </control>
    <control type="Edit" pathname="/divRoot/panel6/panel7/edit2">
      <left>111</left>
      <top>80</top>
      <width>163</width>
      <height>30</height>
      <leftRatio>0.347962382445141</leftRatio>
      <topRatio>0.327868852459016</topRatio>
      <widthRatio>0.510971786833856</widthRatio>
      <heightRatio>0.122950819672131</heightRatio>
      <sizeRatio>0.184049079754601</sizeRatio>
      <backgroundSkin>edit1</backgroundSkin>
      <layerVisible>false</layerVisible>
      <inputPassword>true</inputPassword>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel4">
      <left>39</left>
      <top>134</top>
      <width>121</width>
      <height>40</height>
      <leftRatio>0.122257053291536</leftRatio>
      <topRatio>0.549180327868853</topRatio>
      <widthRatio>0.379310344827586</widthRatio>
      <heightRatio>0.163934426229508</heightRatio>
      <sizeRatio>0.330578512396694</sizeRatio>
      <backgroundSkin>skin1003</backgroundSkin>
      <text>登 录</text>
      <fontSize>12</fontSize>
      <fontColor>FFFFFF</fontColor>
      <fontBold>true</fontBold>
      <layerVisible>false</layerVisible>
      <cursor>pointer</cursor>
      <onClick>login();
ee.setVisible(ee.getControl("panel8"), true);</onClick>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel5">
      <left>173</left>
      <top>135</top>
      <width>128</width>
      <height>41</height>
      <leftRatio>0.542319749216301</leftRatio>
      <topRatio>0.55327868852459</topRatio>
      <widthRatio>0.401253918495298</widthRatio>
      <heightRatio>0.168032786885246</heightRatio>
      <sizeRatio>0.3203125</sizeRatio>
      <text><![CDATA[重 置 >>]]></text>
      <fontSize>12</fontSize>
      <fontColor>44C0EB</fontColor>
      <fontBold>true</fontBold>
      <layerVisible>false</layerVisible>
      <cursor>pointer</cursor>
      <onClick>ee.setEditText(ee.getControl("edit1"),"");
ee.setEditText(ee.getControl("edit2"),"");

</onClick>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel8">
      <left>40</left>
      <top>185</top>
      <width>236</width>
      <height>47</height>
      <leftRatio>0.125391849529781</leftRatio>
      <topRatio>0.758196721311475</topRatio>
      <widthRatio>0.739811912225705</widthRatio>
      <heightRatio>0.192622950819672</heightRatio>
      <sizeRatio>0.199152542372881</sizeRatio>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel8/panel9">
      <left>45</left>
      <top>13</top>
      <width>16</width>
      <height>16</height>
      <leftRatio>0.190677966101695</leftRatio>
      <topRatio>0.276595744680851</topRatio>
      <widthRatio>0.0677966101694915</widthRatio>
      <heightRatio>0.340425531914894</heightRatio>
      <sizeRatio>1</sizeRatio>
      <backgroundImg>loading.gif</backgroundImg>
    </control>
    <control type="Panel" pathname="/divRoot/panel6/panel7/panel8/panel10">
      <left>61</left>
      <top>6</top>
      <width>158</width>
      <height>32</height>
      <leftRatio>0.258474576271186</leftRatio>
      <topRatio>0.127659574468085</topRatio>
      <widthRatio>0.669491525423729</widthRatio>
      <heightRatio>0.680851063829787</heightRatio>
      <sizeRatio>0.20253164556962</sizeRatio>
      <text>正在登陆,请稍后......</text>
      <fontSize>10</fontSize>
    </control>
  </controls>
  <sqlResultSet count="0" />
  <taskSet count="1">
    <taskSetItem name="login">
      <script1>g5.username = ee.getEditText(ee.getControl("edit1"));
g5.password = ee.getEditText(ee.getControl("edit2"));
if (g5.username.length==0) {
    alert("请输入用户名");
    return;
}
eio.appendString8(g5.username);
eio.appendString8(g5.password);
 </script1>
      <script2>var username = eio.readString8();
var password = eio.readString8();
var passwordMd5 = es.getMd5(password);
//var sql = "select * from adminAccount where username='" + db.encode(username) + "' and (password='" + passwordMd5 + "' or password = '')";
var sql = "select * from T_USER where user_name='" + db.encode(username) + "' and (user_password='" +  db.encode(password) + "' or user_password= '')";
var sqlResult = db.executeQuery("QR", sql);
if (sqlResult == null) {
    eio.appendString8("系统繁忙，请稍后再试");
    eio.appendString8(sql);
    return;
} else {
    if (db.read(sqlResult)) {
        eio.appendString8("");
        session.set("username",username);
        //webService获取系统的userid
        //var webService="http://61.132.46.170:33819/ws_yongkong/FlowService.asmx?wsdl";
        var webService="http://localhost:33819/ws_yancheng/FlowService.asmx?wsdl";
        session.set("webservice", webService);
        //var path="E:\\wwroot\\web_taizhou\\process\\GongDanList.xml"; 
        var path="D:\\wwwroot\\web_yancheng\\process\\WorkOrderProcess.xml";
        session.set("path", path);
        var useridFlag = es.wsExecuteQuery(webService,"login",[username,password]);
        if (useridFlag) {
            var userId=es.wsGetInt();
            session.set("userid", userId);            
            es.wsExecuteQuery(webService,"insertLoginInfo",[userId]);
            
            var loginCountFlag = es.wsExecuteQuery(webService,"GetLoginCount",[userId]);
            if(loginCountFlag){
                var loginCount=es.wsGetInt();
                session.set("logincount", loginCount);               
            }
                        
            var loginInfoFlag = es.wsExecuteQuery(webService,"GetLoginInfo",[userId]);
            if(loginInfoFlag){
                var loginInfo=es.wsGetString();
                session.set("logininfo", loginInfo);               
            }
                       
            var roleidFlag = es.wsExecuteQuery(webService,"GetRoleID",[userId]);
            if(roleidFlag){
                var roleId=es.wsGetInt();
                var accessFlag = es.wsExecuteQuery(webService,"GetAccess",[roleId]);
                if(accessFlag){ 
                    session.set("access", es.wsGetString());
                }
            }
            
            var userDeptFlag = es.wsExecuteQuery(webService,"GetUserDept",[userId]);
            if(userDeptFlag){
                session.set("userdept", es.wsGetString());                
            }
            
            var json="{}";
            var taskNumFlag = es.wsExecuteQuery(webService,"listTaskRecord",[path,userId,json]);
            if(taskNumFlag){
                session.set("tasknum", es.wsGetInt());
            }            
        } 
        
    } else {
        eio.appendString8("用户名或密码错误");
    }
}

  </script2>
      <script3><![CDATA[var result = eio.readString8();
if (result.length > 0) {
    alert("无法登录：" + result);
    return;
}
window.location.href = ee.pageRoot + "/main"; 
 ]]></script3>
    </taskSetItem>
  </taskSet>
  <gridLines count="0" />
</page>